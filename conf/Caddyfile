# 全局配置
{
	admin off
}

:11451 {
	# 静态文件服务
	root * /srv

	# SPA 路由支持
	file_server
	try_files {path} /index.html

	# 缓存配置

	# SPA general routes
	@header_general {
		not path *.*
	}
	header @header_general {
		Cache-Control "no-cache, must-revalidate"
	}

	# assets
	@header_assets {
		path *.png *.jpg *.jpeg *.gif *.svg *.webp *.avif *.woff *.woff2 *.ttf *.eot *.ico *.mp4 *.webm *.ogg *.avi *.mov
	}
	header @header_assets {
		Cache-Control "public, max-age=604800"
	}

	# js css
	@header_js_css {
		path *.js *.mjs *.css
	}
	header @header_js_css {
		Cache-Control "public, max-age=604800, immutable"
	}

	# xivplancn
	@header_xivplancn {
		path *.xivplancn
	}
	header @header_xivplancn {
		Content-Type "application/json"
		Content-Disposition "attachment"
		Cache-Control "no-cache, no-store, must-revalidate"
	}

	# 安全头
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
		Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src https: data: blob:; font-src 'self' data:; connect-src 'self' https://xivapi.com https://*.xivapi.com; worker-src 'self' blob:;"
		# EdgeOne 头部
		X-Real-IP {http.request.header.EO-Client-IP}
		X-Client-IP {http.request.header.EO-Client-IP}
		X-Client-Country {http.request.header.EO-Client-IPCountry}
		# 保留标准头部以兼容其他 CDN
		X-Forwarded-For {http.request.header.X-Forwarded-For}
		-Server
	}

	# 日志
	log {
		output stdout
		format console
	}
}
